// Dependencies
import React, { useEffect } from 'react'
import { useParams } from 'react-router';
import { useDispatch, useSelector } from 'react-redux';
import { Link } from 'react-router-dom';

// Externals
import BasketCart from 'components/BasketCart';
import { fetchPhoneById, addPhoneToBasket } from 'actions'
import { getPhoneById } from 'services/selectors'


const Phone = () => {
  const { id } = useParams();

  const dispatch = useDispatch();
  const phonesObj = useSelector((state) => state.phonesObj)
  const phoneId = useSelector((state) => state.phoneSoloPage)

  const phoneItem = getPhoneById(phonesObj, phoneId.id)

  useEffect(() => {
    dispatch(fetchPhoneById(id))
  }, [id])

  // Функции для отрисовки/трансформации данных контента
  const renderFields = () => {
    // Поля для фильтрации
    const filterFields = ['battery', 'camera', 'cpu', 'display', 'memory', 'size', 'weight']
    const columnField = Object.entries(phoneItem).filter((item) => filterFields.indexOf(item[0]) !== -1)

    return (
      columnField.map(([key, value]) => {
        return (
          <div className='column' key={key}>
            <div className='ab-details-title'><p>{key}</p></div>
            <div className='ab-details-info'>{value}</div>
          </div>)
      }))

  }

  const renderPhoneContent = () => {
    return (
      <div className='thumbnail'>
        <div className='row'>
          <div className='col-md-6 flex__img'>
            <img className='img-thumbnail' src={phoneItem.image} alt={phoneItem.name} />
          </div>
          <div className='col-md-6'>{renderFields()}</div>
        </div>
        <div className='caption-full'>
          <h4 className='pull-right'>${phoneItem.price}</h4>
          <h4>{phoneItem.name}</h4>
          <p>{phoneItem.description}</p>
        </div>
      </div>
    )
  }

  const renderSidebar = () => {
    return (
      <div>
        <p className='lead'>Quick shop</p>
        <BasketCart />
        <div className='form-group'>
          <h1>{phoneItem.name}</h1>
          <h2>{`${phoneItem.price}$`}</h2>
        </div>
        <Link to='/' className='btn btn-info btn-block'>Back to store</Link>
        <button
          type='button'
          className='btn btn-success btn-block'
          onClick={() => dispatch(addPhoneToBasket(phoneItem.id))}
        > Add to cart
        </button>
      </div>
    )
  }

  return (
    <div className='view-container'>
      <div className='container'>
        <div className='row'>
          <div className='col-md-9'>{phoneItem && renderPhoneContent()}</div>
          <div className='col-md-3'>{phoneItem && renderSidebar()}</div>
        </div>
      </div>
    </div>
  )
}

export default Phone